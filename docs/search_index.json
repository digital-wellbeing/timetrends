[
["index.html", "Technology effect timecourses Chapter 1 Preface 1.1 Analyses and reproducibility 1.2 Raw data", " Technology effect timecourses Matti Vuorre 2020-09-02 Chapter 1 Preface We study the timecourse of technology effects on adolescent mental health in three large representative datasets. 1.1 Analyses and reproducibility The data analyses are organized into separate R Markdown files. First, there are three files that do preprocessing of the raw datasets (extracting the relevant variables from the raw data). Then, the data is cleaned a bit further and visualized. The main analyses are in the modelling scripts, that build up to the most robust treatment, the bayesian generalized linear mixed model. The project is organized as a R bookdown project, so you can reproduce all analyses by building the book (e.g. in RStudio click the “Build Book” button). (Be advised, though, that the Bayesian GLMMs take a very long time to run [many days]). The results are rendered to docs/index.html and can be viewed in a web browser. 1.2 Raw data The datasets’ Terms of Use prevent us for sharing the data files here, so you must download the raw data yourself. Get the data as follows so it is in the format expected by our code: Monitoring the Future Monitoring the Future (MTF) Public-Use Cross-Sectional Datasets https://www.icpsr.umich.edu/icpsrweb/ICPSR/series/35 Download each year’s data in Stata format to data-raw/mtf/ Unzip each file so that you end up with directories like data-raw/mtf/ICPSR_xxxxx Understanding society Understanding Society: Waves 1-9, 2009-2018 https://beta.ukdataservice.ac.uk/datacatalogue/studies/study?id=6614 http://doi.org/10.5255/UKDA-SN-6614-13 Download the SPSS format data into data-raw/us/ Unzip the file so that you end up with data-raw/us/UKDA-6614-spss/ Youth Risk Behavior Survey The combined National YRBS data https://www.cdc.gov/healthyyouth/data/yrbs/data.htm Download the National ASCII format data and the associated SPSS syntax to data-raw/yrbs/ Process the ASCII file in place with the SPSS syntax file, so you end up with a file data-raw/yrbs/sadc_2017_national.sav "],
["mtf-preprocessing.html", "Chapter 2 MTF preprocessing 2.1 Save to disk", " Chapter 2 MTF preprocessing Get list of individual data files’ names MTFfiles &lt;- list.files( path = &quot;data-raw/mtf/&quot;, pattern = &quot;\\\\.dta$&quot;, recursive = TRUE, full.names = TRUE ) After this, we have to list all the variables we want to examine in our study. We should do this by using labels of variables which can be found in the codebooks. The reason we’re doing this is because label naming of the MTF dataset remained more or less consistent throughout the years, while variable naming isn’t consistent. Therefore, we can merge the data from different years by using labels, but not by using variable names themselves. For now, let’s go with the following variables: vars &lt;- c(&quot;YEAR OF&quot;, &quot;S SEX&quot;, &quot;s SEX&quot;, &quot;WHAT GRADE LEVL&quot;, &quot;VRY HPY THS DAY&quot;, &quot;SATISFD W MYSELF&quot;, &quot;LIFE MEANINGLESS&quot;, &quot;I ENJOY LIFE&quot;, &quot;HOPELESS&quot;, &quot;GOOD TO BE ALIVE&quot;, &quot;FUTR R LIFE WRSE&quot;, &quot;AM PRSN OF WORTH&quot;, &quot;DO WELL AS OTHRS&quot;, &quot;MUCH TO B PROUD&quot;, &quot;I AM NO GOOD&quot;, &quot;I DO WRONG THING&quot;, &quot;MY LIFE NT USEFL&quot;, &quot;POS ATT TWD SELF&quot;, &quot;OFTN FEEL LONELY&quot;, &quot;ALWYS SM1 HELP&quot;, &quot;OFTN FL LEFT OUT&quot;, &quot;USLY SM1 TALK TO&quot;, &quot;OFT WSH MOR FRND&quot;, &quot;USLY FRDS BE WTH&quot;, &quot;SAT LIFE AS WHL&quot;, &quot;CMP SATFD&quot;, &quot;PUTR SC&quot;, &quot;PUTR OT&quot;, &quot;PUTR JO&quot;, &quot;DAY HRS WATCH&quot;, &quot;END HRS WATCH&quot;, &quot;W GAMING&quot;, &quot;W INTERNET&quot;, &quot;TV/DAY&quot;, &quot;TV/WKEND&quot;, &quot;WEB FACEBK&quot;, &quot;HRS MUSIC&quot;) Before proceeding with the merge, we have to create: An empty dataframe that will contain the merged data after the process is complete, which has the same number of columns as the number of our variables of interest and the columns are named accordingly; MTF &lt;- data.frame(matrix(ncol = length(vars))) colnames(MTF) &lt;- vars A list which will contain the data of interest from separate datafiles before it’s merged; intermediate &lt;- list() A list which will contain the labels of separate datafiles labels &lt;- list() A vector which will contain column numbers of our variables of interest; indices &lt;- vector(&quot;numeric&quot;) A vector which will contain column names of our variables of interest; A vector which will contain column numbers of columns that are unlabelled and should be removed. names &lt;- vector(&quot;character&quot;) Now we can go ahead with the merge. Please see inline comments for detailed descriptions! for (i in 1:length(MTFfiles)) { # Importing the file and adding it to the intermediate list intermediate[[i]] &lt;- read_dta(MTFfiles[i]) # Checking if the Grade variable is present in the file; if not, it&#39;s 12th grade if (any(grepl(&quot;WHAT GRADE LEVL&quot;, unlist(var_label(intermediate[[i]])))) == F) { intermediate[[i]][, (ncol(intermediate[[i]]) + 1)] &lt;- 12 var_label(intermediate[[i]][ncol(intermediate[[i]])]) &lt;- &quot;WHAT GRADE LEVL&quot; } # Extracting labels while making sure that unlabelled columns are not dropped from the indexing labels[[i]] &lt;- var_label(intermediate[[i]]) labels[[i]][sapply(labels[[i]], is.null)] &lt;- NA labels[[i]] &lt;- unlist(labels[[i]]) for (j in 1:length(vars)) { # Extracting the column numbers of variables of interest indices &lt;- c(indices, grep(vars[j], labels[[i]])) # Extracting the column names of variables of interest names &lt;- c(names, regmatches(labels[[i]], regexpr(vars[j], labels[[i]]))) } # Removing all variables from the file except those we have chosen intermediate[[i]] &lt;- intermediate[[i]][, indices] # Assigning labels as variable names so data can be merged colnames(intermediate[[i]]) &lt;- names # Cleaning the vectors indices &lt;- vector(&quot;numeric&quot;) names &lt;- vector(&quot;character&quot;) # Remove value labels so can be merged intermediate[[i]] &lt;- zap_labels(intermediate[[i]]) } # Merging the data in the main dataframe MTF &lt;- plyr::rbind.fill(intermediate) After merging the files, there are some leftover things we still have to do * Variables with the labels ‘SAT LIFE AS WHL’ and ‘CMP SATFD’ are actually the same variable and they should be merged; MTF$`SAT LIFE AS WHL` &lt;- rowSums(MTF[, c(&quot;SAT LIFE AS WHL&quot;, &quot;CMP SATFD&quot;)], na.rm = T) MTF &lt;- subset(MTF, select = -`CMP SATFD`) vars &lt;- vars[-26] The above also applies to variables with the labels ‘S SEX’ and ‘s SEX’; MTF$`S SEX` &lt;- rowSums(MTF[, c(&quot;S SEX&quot;, &quot;s SEX&quot;)], na.rm = T) MTF &lt;- subset(MTF, select = -`s SEX`) vars &lt;- vars[-3] Numerical values which indicate various types of missing data have to be removed (i.e., coded as NA); MTF[MTF == 0] &lt;- NA MTF[MTF == 8] &lt;- NA MTF[MTF == 9] &lt;- NA MTF[MTF == -9] &lt;- NA MTF[MTF == -8] &lt;- NA Cases which contain data only for 3 variables (year of administration, gender and grade) have to be removed; MTF &lt;- MTF[!rowSums(is.na(MTF[, c(4:length(vars))])) == (length(vars) - 3), ] Cases which have unidentified labels for the Sex variable (3, 4, 5, 6 and 7) will be dropped; MTF &lt;- subset(MTF, `S SEX` == 1 | `S SEX` == 2) Cases which have unidentified labels for the Grade variable (3, 5, 6 and 7) will be dropped; MTF &lt;- subset(MTF, `WHAT GRADE LEVL` == 2 | `WHAT GRADE LEVL` == 4 | `WHAT GRADE LEVL` == 12) Cases which have missing values in the Year variable should be dropped; MTF &lt;- drop_na(MTF, `YEAR OF`) Initial row numbers should be dropped – convert to tibble takes care of this MTF &lt;- as_tibble(MTF) Values of years which were coded using only last two digits (e.g. 92 instead of 1992) have to be corrected; MTF$`YEAR OF` &lt;- recode(MTF$`YEAR OF`, &quot;76=1976;77=1977;78=1978;79=1979;80=1980;81=1981;82=1982;83=1983;84=1984;85=1985;86=1986;87=1987;88=1988;89=1989;90=1990;91=1991;92=1992;93=1993;94=1994;95=1995;96=1996;97=1997;98=1998&quot;) Sex variable has to be recoded from 1 and 2 to Male and Female, respectively; MTF$`S SEX`[MTF$`S SEX` == 1] &lt;- &quot;Male&quot; MTF$`S SEX`[MTF$`S SEX` == 2] &lt;- &quot;Female&quot; In the Grade variable, values of 2 and 4 have to ve recoded to 8 and 10, respectively; MTF$`WHAT GRADE LEVL` &lt;- recode(MTF$`WHAT GRADE LEVL`, &quot;2=8;4=10&quot;) Labels have to be removed from the data (we’ll add new, more meaningful ones later); All unnecessary variables which were used in the merging process have to be removed to save memory and space; rm(i, indices, j, labels, MTFfiles, vars, names, intermediate) Sex will be turned to factor; MTF$`S SEX` &lt;- as.factor(MTF$`S SEX`) Convert grade to approximate age (age = grade + 5) MTF$`WHAT GRADE LEVL` &lt;- MTF$`WHAT GRADE LEVL` + 5 We will sort the data by year of administration. MTF &lt;- arrange(MTF, `YEAR OF`) Rename variables colnames(MTF) &lt;- c(&quot;Year&quot;, &quot;Sex&quot;, &quot;Age&quot;, &quot;H&quot;, &quot;S&quot;, &quot;SE_R_1&quot;, &quot;SE_R_7&quot;, &quot;SE_R_4&quot;, &quot;SE_R_5&quot;, &quot;SE_R_2&quot;, &quot;D_B_1&quot;, &quot;D_B_2&quot;, &quot;SE_R_10&quot;, &quot;F&quot;, &quot;TV&quot;, &quot;L_MTF_1&quot;, &quot;L_MTF_2&quot;, &quot;L_MTF_3&quot;, &quot;L_MTF_4&quot;, &quot;L_MTF_5&quot;, &quot;L_MTF_6&quot;, &quot;D_B_3&quot;, &quot;D_B_4&quot;, &quot;D_B_5&quot;, &quot;D_B_6&quot;, &quot;TV/WEEKEND&quot;, &quot;COMPUTER/SCHOOL&quot;, &quot;COMPUTER/OTHER&quot;, &quot;COMPUTER JOB&quot;, &quot;INTERNET/WEEK&quot;, &quot;GAMING/WEEK&quot;, &quot;SM&quot;, &quot;music&quot;, &quot;SCREENTIME/WEEKDAY&quot;, &quot;SCREENTIME/WEEKEND&quot;) Let’s also recode the items, so that all the responses indicate higher development of the construct - higher self-esteem, higher loneliness, more depressive symptoms. We’ll also assign labels to those variables. MTF$SE_R_5 &lt;- recode(MTF$SE_R_5, &quot;1=5;2=4;4=2;5=1&quot;) MTF$SE_R_2 &lt;- recode(MTF$SE_R_2, &quot;1=5;2=4;4=2;5=1&quot;) MTF$L_MTF_2 &lt;- recode(MTF$L_MTF_2, &quot;1=5;2=4;4=2;5=1&quot;) MTF$L_MTF_4 &lt;- recode(MTF$L_MTF_4, &quot;1=5;2=4;4=2;5=1&quot;) MTF$L_MTF_6 &lt;- recode(MTF$L_MTF_6, &quot;1=5;2=4;4=2;5=1&quot;) MTF$D_B_4 &lt;- recode(MTF$D_B_4, &quot;1=5;2=4;4=2;5=1&quot;) MTF$D_B_6 &lt;- recode(MTF$D_B_6, &quot;1=5;2=4;4=2;5=1&quot;) Remove data before 1991 because it only includes 12th graders (and thus if you include it, any change over time in the aggregate may just reflect a change from 12th graders to mean(8th grade, 10th grade, 12th grade)…) MTF &lt;- filter(MTF, Year &gt; 1990) Focus on individuals 15 years old or younger MTF &lt;- filter(MTF, Age &lt;= 15) Aggregate, rename, recode MTF &lt;- MTF %&gt;% # Select variables select( Year, Sex, TV, SM, contains(&quot;D_B_&quot;) ) %&gt;% mutate( Depression = rowMeans(select(., starts_with(&quot;D_B_&quot;)), na.rm = TRUE) ) contrasts(MTF$Sex) &lt;- matrix(c(.5, -.5)) We’re not going to do anything with rows where all D_B_ items were missing, so we drop those from the data MTF &lt;- drop_na(MTF, Depression) 2.1 Save to disk saveRDS(MTF, &quot;data/mtf.rds&quot;) "],
["us-preprocessing.html", "Chapter 3 US preprocessing 3.1 Year 3.2 Strengths and difficulties 3.3 Save file", " Chapter 3 US preprocessing # Function to read adolescents&#39; data from one file read_adolescent_data &lt;- function(filename){ # Select relevant variables, define NAs (any negative numbers), remove &quot;yp&quot; from the beginning of variable names dataset &lt;- read_spss(filename) dataset &lt;- dataset %&gt;% select(-ends_with(&quot;_sex&quot;)) %&gt;% rename_all(~str_replace(., &quot;yp&quot;, &quot;&quot;)) %&gt;% select( contains(&quot;pidp&quot;), # Participant ID ends_with(&quot;age_dv&quot;), # Participant age ends_with(&quot;socweb&quot;), # Do you have social media profile? ends_with(&quot;netcht&quot;), # Hours using social media on weekdays ends_with(&quot;tvvidhrs&quot;), # TV on weekdays (all waves) contains(&quot;sdq&quot;), # Strengths and difficulties -ends_with(&quot;_orig&quot;), -ends_with(&quot;sdqes_dv&quot;), -ends_with(&quot;sdqcp_dv&quot;), -ends_with(&quot;sdqha_dv&quot;), -ends_with(&quot;sdqpp_dv&quot;), -ends_with(&quot;sdqps_dv&quot;), -ends_with(&quot;sdqtd_dv&quot;) ) is.na(dataset[, ]) &lt;- dataset[, ] &lt; 0 #define NAs # Remove dataset indicator letter from variable names so that datasets can be merged names(dataset) &lt;- str_remove(names(dataset), &quot;[a-z]_&quot;) # Get rid of number labels dataset &lt;- zap_labels(dataset) return(dataset) } # Load the adolescent data from the folders downloaded from the UK data service. files_adolescent &lt;- list.files(&quot;data-raw/us/&quot;, pattern = &quot;_youth.sav&quot;, recursive = TRUE, full.names = TRUE) files_adolescent &lt;- files_adolescent[str_detect(files_adolescent, &quot;ukhls&quot;)] data &lt;- map(files_adolescent, read_adolescent_data) # Combine adolescent data from different waves (files) into long format # Removes SPSS labels from variables &amp; values data &lt;- bind_rows(data, .id = &quot;wave&quot;) # Exclude any teenagers from the adolescent data that are under 10 or over 15 data &lt;- data %&gt;% filter(between(age_dv, 10, 15)) %&gt;% select(-age_dv) # Get sex from &quot;stable characteristics&quot; file # In Understanding Society that have a specific file &quot;ukhls_wx/xwavedat.sav&quot; which indicates stable characteristics of participants in the survey. We prefer to use this for sex because it is derived from multiple interviews and checked for consistency. data_stable &lt;- list.files( &quot;data-raw/us/&quot;, pattern = &quot;xwavedat.sav&quot;, recursive = TRUE, full.names = TRUE ) %&gt;% read_spss(col_select = c(&quot;pidp&quot;, &quot;sex_dv&quot;)) is.na(data_stable[, ]) &lt;- data_stable[, ] &lt; 0 # define NAs as anything under 0 data_stable$sex_dv &lt;- as_factor(data_stable$sex_dv) %&gt;% fct_drop() data_stable &lt;- zap_labels(data_stable) data &lt;- left_join(data, data_stable, by = &quot;pidp&quot;) data &lt;- rename(data, Sex = sex_dv) Sex: Take out (10) inconsistent responses table(data$Sex) data &lt;- filter(data, Sex != &quot;inconsistent&quot;) data &lt;- data %&gt;% mutate(Sex = factor(Sex, levels = c(&quot;Female&quot;, &quot;Male&quot;))) table(data$Sex, useNA = &quot;always&quot;) # Contrast code sex contrasts(data$Sex) &lt;- matrix(c(.5, -.5)) # Rename variables data &lt;- data %&gt;% rename( socialmedia = socweb, socialmediaamount = netcht, TV = tvvidhrs ) We first clean and recode the social media use variable. This variable is complicated as there was a mistake on the side of Understanding Society, who were inconsistent in how they directed children and adults through the study in different years. Sometimes those who said they dont use social media on “netcht” were automatically coded as none on “socweb” and sometimes this wasnt the case. There is no easy solution for this, so we went with a recoding solution detailed below. If a participant said they do not own a social media account or they dont use social media to interact with friends we coded them as 1, for the rest of the participants we took their netcht score. This creates the following scale, which is ordinal in nature: 1 = None, 2 = Less than an hour, 3 = 1-3 hours, 4 = 4-6 hours, 5 = 7 or more hours # set 9 to NA to revert coding error is.na(data[, c(&quot;socialmediaamount&quot;, &quot;socialmedia&quot;)]) &lt;- data[, c(&quot;socialmediaamount&quot;, &quot;socialmedia&quot;)] == 9 data$socialmedia &lt;- ifelse((data$socialmedia == 2 | data$socialmediaamount == 1), 1, ifelse(data$socialmediaamount == 2, 2, ifelse(data$socialmediaamount == 3, 3, ifelse(data$socialmediaamount == 4, 4, ifelse(data$socialmediaamount == 5, 5, NA))))) data &lt;- data %&gt;% select(-socialmediaamount) data &lt;- rename(data, SM = socialmedia) 3.1 Year # Convert wave to year # Waves 1-9 to years 2009 -&gt; data &lt;- rename(data, Year = &quot;wave&quot;) data$Year &lt;- as.numeric(data$Year) + 2008 3.2 Strengths and difficulties Our main outcome. It is only recorded every second year so we take out the years where it was not recorded. data &lt;- data %&gt;% # SDQ only measured in these waves filter(Year %in% c(2009, 2011, 2013, 2015, 2017)) Recode: Greater values indicate greater difficulties data &lt;- data %&gt;% mutate_at( paste0(&quot;sdq&quot;, c(&quot;a&quot;, &quot;d&quot;, &quot;g&quot;, &quot;i&quot;, &quot;k&quot;, &quot;n&quot;, &quot;q&quot;, &quot;t&quot;, &quot;u&quot;, &quot;y&quot;)), function(x) 4 - x ) SDQ subscales: http://sdqinfo.org/c9.html sdq_emo &lt;- c(&quot;sdqc&quot;, &quot;sdqh&quot;, &quot;sdqm&quot;, &quot;sdqp&quot;, &quot;sdqx&quot;) sdq_con &lt;- c(&quot;sdqe&quot;, &quot;sdqg&quot;, &quot;sdql&quot;, &quot;sdqr&quot;, &quot;sdqv&quot;) # Compute means of two subscales data &lt;- data %&gt;% mutate( Emotion = rowMeans(select(., all_of(sdq_emo)), na.rm=T), Conduct = rowMeans(select(., all_of(sdq_con)), na.rm=T) ) # Remove all but these two subscales from SDQ variables sdq &lt;- select(data, starts_with(&quot;sdq&quot;)) data &lt;- select(data, !starts_with(&quot;sdq&quot;)) data &lt;- bind_cols( data, sdq %&gt;% select(all_of(sdq_emo), all_of(sdq_con)) ) rm(sdq) 3.3 Save file data &lt;- data %&gt;% # Drop all rows where sex or year is missing drop_na(Sex, Year) # Save file to disk saveRDS(data, &quot;data/us.rds&quot;) "],
["yrbs-preprocessing.html", "Chapter 4 YRBS preprocessing 4.1 Recode Variables 4.2 Age 4.3 Tech variables 4.4 Sex 4.5 Rename and save", " Chapter 4 YRBS preprocessing # Load data without dichotomized and supplemental items data &lt;- read_spss( &quot;data-raw/yrbs/sadc_2017_national.sav&quot;, col_select = c( year, age, sex, q25:q29, q80, q81, ) ) # Drop cases where age or sex are unknown data &lt;- drop_na(data, age, sex) # Choose appropriate years: 2007-2015 data &lt;- data %&gt;% filter(year &gt; 2006) # Convert SPSS labels to factor labels and remove other SPSS attributes data &lt;- as_factor(data) 4.1 Recode Variables Read about the variables at https://www.cdc.gov/healthyyouth/data/yrbs/pdf/2017/2017_yrbs_sadc_documentation.pdf # Sad/Lonely and Dichotomous suicide variables to numeric (0 = no, 1 = yes) data &lt;- mutate_at(data, vars(q25, q26, q27), ~1 - (as.numeric(.) - 1)) # During the past 12 months, how many times did you actually attempt suicide? data &lt;- mutate(data, q28 = as.numeric(q28) - 1) # This is dichotomized data &lt;- mutate(data, q28 = ifelse(q28==0, 0, 1)) # If you attempted suicide during the past 12 months, did any attempt result in an injury, poisoning, or overdose that had to be treated by a doctor or nurse? data &lt;- mutate( data, q29 = factor(q29, levels = c(&quot;Did not attempt suicide&quot;, &quot;No&quot;, &quot;Yes&quot;)), q29 = as.numeric(q29)-1 ) Aggregate data &lt;- data %&gt;% mutate( Suicide = rowMeans(select(., q25:q28), na.rm=T) ) 4.2 Age # Recode age as continuous with correct values # Note: 12 and 18 include younger/older individuals data &lt;- mutate(data, age = as.numeric(age) + 11) # Focus on individuals 15 years old or younger data &lt;- filter(data, age &lt;= 15) data &lt;- select(data, -age) 4.3 Tech variables # Convert tech variable to numeric data &lt;- mutate_at(data, vars(q80, q81), ~as.numeric(.)) 4.4 Sex contrasts(data$sex) &lt;- matrix(c(.5, -.5)) 4.5 Rename and save # Rename data &lt;- data %&gt;% rename( Year = year, Sex = sex, TV = q80, DV = q81, sad_lonely = q25, suicide_1 = q26, suicide_2 = q27, suicide_3 = q28, suicide_4 = q29, ) data # Save data to disk saveRDS(data, &quot;data/yrbs.rds&quot;) "],
["data-descriptives.html", "Chapter 5 Data descriptives 5.1 Data 5.2 Figures", " Chapter 5 Data descriptives 5.1 Data mtf &lt;- read_rds(&quot;data/mtf.rds&quot;) us &lt;- read_rds(&quot;data/us.rds&quot;) yrbs &lt;- read_rds(&quot;data/yrbs.rds&quot;) 5.1.1 Sample sizes and years Sample sizes per dataset are the number of rows that include the outcome variable (there are two for US). The total sample size in the entire manuscript is the sum without US-emotion (including both US outcomes would duplicate its N). tibble( mtf = drop_na(mtf, Depression) %&gt;% nrow, us_conduct = drop_na(us, Conduct) %&gt;% nrow, us_emotion = drop_na(us, Emotion) %&gt;% nrow, yrbs = drop_na(yrbs, Suicide) %&gt;% nrow ) %&gt;% mutate(total = mtf + us_conduct + yrbs) %&gt;% mutate(across(.fns = ~comma(.))) %&gt;% kable() mtf us_conduct us_emotion yrbs total 380,924 19,190 19,184 30,447 430,561 Actual sample sizes used in analyses are the intersections of non-missing values for the two variables (outcome, technology) used in each model. doit &lt;- function(data, name, x, y) { data &lt;- data %&gt;% drop_na(all_of(x), all_of(y)) data %&gt;% count(Sex) %&gt;% pivot_wider(names_from = Sex, values_from = n) %&gt;% mutate(Total = Female + Male) %&gt;% mutate( across( c(Female, Male), ~str_glue(&quot;{comma(.)} ({percent(./Total)})&quot;) ) ) %&gt;% mutate(across(where(is.numeric), ~comma(.))) %&gt;% mutate(Years = paste(range(data$Year), collapse = &quot; - &quot;)) %&gt;% mutate(Dataset = name, Technology = x, Outcome = y) %&gt;% select(Dataset, Technology, Outcome, Years, Total, Female, Male) } bind_rows( doit(mtf, &quot;MTF&quot;, &quot;TV&quot;, &quot;Depression&quot;), doit(mtf, &quot;MTF&quot;, &quot;SM&quot;, &quot;Depression&quot;), doit(us, &quot;US&quot;, &quot;TV&quot;, &quot;Emotion&quot;), doit(us, &quot;US&quot;, &quot;SM&quot;, &quot;Emotion&quot;), doit(us, &quot;US&quot;, &quot;TV&quot;, &quot;Conduct&quot;), doit(us, &quot;US&quot;, &quot;SM&quot;, &quot;Conduct&quot;), doit(yrbs, &quot;YRBS&quot;, &quot;TV&quot;, &quot;Suicide&quot;), doit(yrbs, &quot;YRBS&quot;, &quot;DV&quot;, &quot;Suicide&quot;) ) %&gt;% arrange(Dataset, Technology, Outcome) %&gt;% kable() Dataset Technology Outcome Years Total Female Male MTF SM Depression 2012 - 2017 78,357 40,172 (51%) 38,185 (49%) MTF TV Depression 1991 - 2017 367,444 191,859 (52%) 175,585 (48%) US SM Conduct 2009 - 2017 18,815 9,434 (50%) 9,381 (50%) US SM Emotion 2009 - 2017 18,811 9,432 (50%) 9,379 (50%) US TV Conduct 2009 - 2017 19,079 9,554 (50%) 9,525 (50%) US TV Emotion 2009 - 2017 19,074 9,552 (50%) 9,522 (50%) YRBS DV Suicide 2007 - 2017 29,450 15,424 (52%) 14,026 (48%) YRBS TV Suicide 2007 - 2017 29,433 15,422 (52%) 14,011 (48%) 5.1.2 Outcomes mtf %&gt;% select(starts_with(&quot;D_B_&quot;)) %&gt;% psych::alpha() %&gt;% summary ## ## Reliability analysis ## raw_alpha std.alpha G6(smc) average_r S/N ase mean sd median_r ## 0.85 0.85 0.84 0.48 5.5 0.00039 2 0.95 0.44 cor( select(mtf, starts_with(&quot;D_B_&quot;)), use = &quot;pairwise.complete.obs&quot; ) %&gt;% round(2) ## D_B_1 D_B_2 D_B_3 D_B_4 D_B_5 D_B_6 ## D_B_1 1.00 0.60 0.48 0.34 0.56 0.34 ## D_B_2 0.60 1.00 0.57 0.43 0.63 0.45 ## D_B_3 0.48 0.57 1.00 0.39 0.59 0.39 ## D_B_4 0.34 0.43 0.39 1.00 0.38 0.64 ## D_B_5 0.56 0.63 0.59 0.38 1.00 0.40 ## D_B_6 0.34 0.45 0.39 0.64 0.40 1.00 sdq_con &lt;- c(&quot;sdqe&quot;, &quot;sdqg&quot;, &quot;sdql&quot;, &quot;sdqr&quot;, &quot;sdqv&quot;) sdq_emo &lt;- c(&quot;sdqc&quot;, &quot;sdqh&quot;, &quot;sdqm&quot;, &quot;sdqp&quot;, &quot;sdqx&quot;) us %&gt;% select(all_of(sdq_con)) %&gt;% psych::alpha() %&gt;% summary ## ## Reliability analysis ## raw_alpha std.alpha G6(smc) average_r S/N ase mean sd median_r ## 0.62 0.62 0.58 0.25 1.6 0.0041 1.4 0.36 0.24 us %&gt;% select(all_of(sdq_emo)) %&gt;% psych::alpha() %&gt;% summary ## ## Reliability analysis ## raw_alpha std.alpha G6(smc) average_r S/N ase mean sd median_r ## 0.69 0.69 0.65 0.31 2.2 0.0035 1.6 0.45 0.29 cor( select(us, all_of(sdq_con)), use = &quot;pairwise.complete.obs&quot; ) %&gt;% round(2) ## sdqe sdqg sdql sdqr sdqv ## sdqe 1.00 0.30 0.34 0.34 0.16 ## sdqg 0.30 1.00 0.23 0.24 0.15 ## sdql 0.34 0.23 1.00 0.28 0.21 ## sdqr 0.34 0.24 0.28 1.00 0.23 ## sdqv 0.16 0.15 0.21 0.23 1.00 cor( select(us, all_of(sdq_emo)), use = &quot;pairwise.complete.obs&quot; ) %&gt;% round(2) ## sdqc sdqh sdqm sdqp sdqx ## sdqc 1.00 0.26 0.28 0.19 0.21 ## sdqh 0.26 1.00 0.42 0.39 0.39 ## sdqm 0.28 0.42 1.00 0.29 0.30 ## sdqp 0.19 0.39 0.29 1.00 0.37 ## sdqx 0.21 0.39 0.30 0.37 1.00 5.2 Figures mtf %&gt;% pivot_longer(c(TV, SM, Depression)) %&gt;% drop_na(value) %&gt;% add_count(name) %&gt;% mutate(name = str_glue(&quot;{name} (N = {comma(n)})&quot;)) %&gt;% ggplot(aes(Year, value)) + geom_blank() + stat_summary(fun=mean, geom=&quot;line&quot;) + facet_wrap(&quot;name&quot;, scales = &quot;free_y&quot;) us %&gt;% pivot_longer(c(SM, TV, Emotion, Conduct)) %&gt;% drop_na(value) %&gt;% add_count(name) %&gt;% mutate(name = str_glue(&quot;{name} (N = {comma(n, accuracy = 1)})&quot;)) %&gt;% ggplot(aes(Year, value)) + geom_blank() + stat_summary(fun=mean, geom=&quot;line&quot;) + facet_wrap(&quot;name&quot;, scales = &quot;free_y&quot;) yrbs %&gt;% pivot_longer(c(TV, DV, sad_lonely:suicide_3)) %&gt;% drop_na(value) %&gt;% add_count(name) %&gt;% mutate(name = str_glue(&quot;{name} (N = {comma(n)})&quot;)) %&gt;% ggplot(aes(Year, value)) + geom_blank() + stat_summary(fun=mean, geom=&quot;line&quot;) + facet_wrap(&quot;name&quot;, scales = &quot;free_y&quot;) "],
["generalized-linear-model.html", "Chapter 6 Generalized Linear Model 6.1 Data 6.2 Yearly correlations figure 6.3 Models 6.4 Results", " Chapter 6 Generalized Linear Model This is a first pass. We model the means of the items of each dataset with OLS regression. 6.1 Data mtf &lt;- read_rds(&quot;data/mtf.rds&quot;) us &lt;- read_rds(&quot;data/us.rds&quot;) yrbs &lt;- read_rds(&quot;data/yrbs.rds&quot;) For US, we also isolate between- and within-person variables. us &lt;- bmlm::isolate(us, &quot;pidp&quot;, &quot;TV&quot;, which = &quot;both&quot;, z = TRUE) us &lt;- bmlm::isolate(us, &quot;pidp&quot;, &quot;SM&quot;, which = &quot;both&quot;, z = TRUE) us &lt;- us %&gt;% select(-TV, -SM) # We focus on between-person relations so rename those back us &lt;- us %&gt;% rename(TV = TV_cb, SM = SM_cb) 6.2 Yearly correlations figure fit_year &lt;- function(data, x, y, name) { data &lt;- data[,c(&quot;Year&quot;, x, y, &quot;Sex&quot;)] names(data) &lt;- c(&quot;Year&quot;, &quot;x&quot;, &quot;y&quot;, &quot;Sex&quot;) data %&gt;% drop_na(x, y) %&gt;% group_by(Year) %&gt;% mutate( x = as.numeric(scale(x)), y = as.numeric(scale(y)) ) %&gt;% group_modify(~broom::tidy(lm(y ~ x*Sex, data = .), conf.int = TRUE)) %&gt;% filter(term==&quot;x&quot;) %&gt;% mutate(Technology = x, Outcome = y, data = name) } x1 &lt;- fit_year(mtf, &quot;TV&quot;, &quot;Depression&quot;, &quot;MTF&quot;) x2 &lt;- fit_year(mtf, &quot;SM&quot;, &quot;Depression&quot;, &quot;MTF&quot;) x3 &lt;- fit_year(yrbs, &quot;TV&quot;, &quot;Suicide&quot;, &quot;YRBS&quot;) x4 &lt;- fit_year(yrbs, &quot;DV&quot;, &quot;Suicide&quot;, &quot;YRBS&quot;) x5 &lt;- fit_year(us, &quot;TV&quot;, &quot;Emotion&quot;, &quot;US&quot;) x6 &lt;- fit_year(us, &quot;TV&quot;, &quot;Conduct&quot;, &quot;US&quot;) x7 &lt;- fit_year(us, &quot;SM&quot;, &quot;Emotion&quot;, &quot;US&quot;) x8 &lt;- fit_year(us, &quot;SM&quot;, &quot;Conduct&quot;, &quot;US&quot;) fits_year &lt;- bind_rows(x1,x2,x3,x4,x5,x6,x7,x8) # Rename device and social media to a similar construct fits_year &lt;- fits_year %&gt;% mutate( Technology = ifelse( Technology %in% c(&quot;SM&quot;, &quot;DV&quot;), &quot;Social media / device&quot;, &quot;Television&quot; ) ) fits_year %&gt;% ggplot( aes(Year, estimate, shape = Outcome) ) + geom_hline(yintercept = 0, lty = 2, size = .25) + scale_shape_manual(values = c(15, 16, 21, 22)) + scale_x_continuous( &quot;Year&quot;, breaks = scales::pretty_breaks() ) + scale_y_continuous( &quot;Estimate (±95%CI)&quot;, breaks = scales::pretty_breaks() ) + geom_line( position = position_dodge(.33), size = .25, ) + geom_linerange( position = position_dodge(.33), show.legend = FALSE, aes(ymin = conf.high, ymax = conf.low) ) + geom_point( position = position_dodge(.33), fill = &quot;white&quot;, stroke = 0.75 ) + facet_wrap(&quot;Technology&quot;, scales = &quot;fixed&quot;, ncol = 1) + theme( legend.position = c(0.1,0.77), legend.background = element_rect(fill = NA), legend.key = element_rect(fill = NA), legend.text = element_text(size = 8), legend.box.spacing = unit(0, &quot;cm&quot;) ) ggsave(&quot;Figure1.png&quot;, width = 6, height = 4) 6.3 Models fit &lt;- function(data, name, x, y) { data &lt;- drop_na(data, all_of(x), all_of(y)) # Standardize X and Y data &lt;- mutate(data, across(c(all_of(x), all_of(y)), ~as.numeric(scale(.)))) data &lt;- mutate(data, Year = Year - 2017) ml1 &lt;- lm( str_glue(&quot;{y} ~ Sex * Year * {x}&quot;), data = data ) tibble( data = name, Technology = x, Outcome = y, ml1 = list(ml1) ) } x1 &lt;- fit(yrbs, &quot;YRBS&quot;, &quot;TV&quot;, &quot;Suicide&quot;) x2 &lt;- fit(yrbs, &quot;YRBS&quot;, &quot;DV&quot;, &quot;Suicide&quot;) x3 &lt;- fit(mtf, &quot;MTF&quot;, &quot;TV&quot;, &quot;Depression&quot;) x4 &lt;- fit(mtf, &quot;MTF&quot;, &quot;SM&quot;, &quot;Depression&quot;) x5 &lt;- fit(us, &quot;US&quot;, &quot;SM&quot;, &quot;Emotion&quot;) x6 &lt;- fit(us, &quot;US&quot;, &quot;SM&quot;, &quot;Conduct&quot;) x7 &lt;- fit(us, &quot;US&quot;, &quot;TV&quot;, &quot;Emotion&quot;) x8 &lt;- fit(us, &quot;US&quot;, &quot;TV&quot;, &quot;Conduct&quot;) fits &lt;- bind_rows(x1,x2,x3,x4,x5,x6,x7,x8) # Labels for plots fits &lt;- fits %&gt;% mutate( Technology = ifelse( Technology %in% c(&quot;SM&quot;, &quot;DV&quot;), &quot;Social media / device&quot;, &quot;Television&quot; ) ) 6.4 Results fits %&gt;% mutate(Outcome = fct_rev(Outcome)) %&gt;% mutate(linear = map(ml1, ~tidy(., conf.int=TRUE))) %&gt;% unnest(linear) %&gt;% mutate(Parameter = case_when( term == &quot;Year&quot; ~ &quot;Year&quot;, term %in% c(&quot;TV&quot;, &quot;SM&quot;, &quot;DV&quot;) ~ &quot;Technology&quot;, term %in% c(&quot;Year:TV&quot;, &quot;Year:SM&quot;, &quot;Year:DV&quot;) ~ &quot;Year x Technology&quot; )) %&gt;% drop_na(Parameter) %&gt;% mutate( Parameter = factor(Parameter, levels = c(&quot;Year&quot;, &quot;Technology&quot;, &quot;Year x Technology&quot;)) ) %&gt;% ggplot(aes(estimate, Outcome, shape = Technology, fill = p.value &lt; .05)) + scale_shape_manual(values = c(21, 22)) + scale_fill_manual(values = c(&quot;white&quot;, &quot;black&quot;), guide = FALSE) + scale_x_continuous( &quot;Parameter estimate&quot;, breaks = scales::pretty_breaks(), expand = expansion(.1) ) + geom_vline(xintercept = 0, lty = 2, size = .25) + geom_linerangeh( position = position_dodge2v(.4), aes(xmin = conf.low, xmax = conf.high) ) + geom_point( size = 2, position = position_dodge2v(.4), ) + facet_wrap(&quot;Parameter&quot;, scales = &quot;free_x&quot;) + theme( legend.position = &quot;bottom&quot;, axis.title.y = element_blank(), panel.spacing.x = unit(12, &quot;pt&quot;) ) YRBS with separate logistic regressions for each outcome tmp &lt;- yrbs %&gt;% pivot_longer(sad_lonely:suicide_3) tmp_tv &lt;- tmp %&gt;% group_by(name) %&gt;% mutate(TV = as.numeric(scale(TV)), Year = Year-2017) %&gt;% group_modify(~tidy(glm(value ~ Year*TV, family = binomial, data = .), conf.int = TRUE)) %&gt;% filter(term != &quot;(Intercept)&quot;) tmp_dv &lt;- tmp %&gt;% group_by(name) %&gt;% mutate(DV = as.numeric(scale(DV)), Year = Year-2017) %&gt;% group_modify(~tidy(glm(value ~ Year*DV, family = binomial, data = .), conf.int = TRUE)) %&gt;% filter(term != &quot;(Intercept)&quot;) bind_rows(tmp_dv, tmp_tv, .id = &quot;Technology&quot;) %&gt;% mutate(Technology = factor(Technology, labels = c(&quot;DV&quot;, &quot;TV&quot;))) %&gt;% mutate(Parameter = case_when( term == &quot;Year&quot; ~ &quot;Year&quot;, term %in% c(&quot;TV&quot;, &quot;DV&quot;) ~ &quot;Technology&quot;, term %in% c(&quot;Year:TV&quot;, &quot;Year:DV&quot;) ~ &quot;Year x Technology&quot; )) %&gt;% drop_na(Parameter) %&gt;% mutate( Parameter = factor(Parameter, levels = c(&quot;Year&quot;, &quot;Technology&quot;, &quot;Year x Technology&quot;)) ) %&gt;% ggplot(aes(estimate, name, fill = p.value &lt; .05, shape = Technology)) + scale_fill_manual(values = c(&quot;white&quot;, &quot;black&quot;), guide = FALSE) + scale_shape_manual(values = c(21, 22)) + scale_x_continuous( &quot;Parameter estimate&quot;, breaks = scales::pretty_breaks(), expand = expansion(.1) ) + geom_vline(xintercept = 0, lty = 2, size = .25) + geom_linerangeh( position = position_dodge2v(.4), aes(xmin = conf.low, xmax = conf.high) ) + geom_point( size = 2, position = position_dodge2v(.4), ) + facet_wrap(&quot;Parameter&quot;, scales = &quot;free_x&quot;) + theme( legend.position = &quot;bottom&quot;, axis.title.y = element_blank(), panel.spacing.x = unit(12, &quot;pt&quot;) ) "],
["bayesian-generalized-linear-mixed-model.html", "Chapter 7 Bayesian Generalized Linear Mixed Model 7.1 Data 7.2 Models", " Chapter 7 Bayesian Generalized Linear Mixed Model For each dataset and outcome, we fit a GLMM using brms, in order to do full bayesian inference. These models take a while to run. 7.1 Data mtf &lt;- read_rds(&quot;data/mtf.rds&quot;) us &lt;- read_rds(&quot;data/us.rds&quot;) yrbs &lt;- read_rds(&quot;data/yrbs.rds&quot;) For US, we also isolate between- and within-person variables. # Within-person center variables (Vuorre &amp; Bolger, 2017) us &lt;- bmlm::isolate(us, &quot;pidp&quot;, &quot;TV&quot;, which = &quot;both&quot;, z = TRUE) us &lt;- bmlm::isolate(us, &quot;pidp&quot;, &quot;SM&quot;, which = &quot;both&quot;, z = TRUE) us &lt;- us %&gt;% select(-TV, -SM) # We focus on between-person relations so rename those back us &lt;- us %&gt;% rename(TV = TV_cb, SM = SM_cb) YRBS is in long format wrt items yrbs &lt;- yrbs %&gt;% select(-suicide_4, -Suicide) %&gt;% pivot_longer( sad_lonely:suicide_3, names_to = &quot;item&quot;, values_to = &quot;Suicide&quot; ) 7.2 Models 7.2.1 Estimate MTF: Single level model US: Random intercepts for participants. 85% of participants have only 1 or 2 observations, so random slopes without strong priors are not a good idea. YRBS: Full item-specific random effects. fit &lt;- function(data, name, x, y, iter = 1000, chains = 12, cores = 12) { data &lt;- drop_na(data, all_of(x), all_of(y)) data &lt;- mutate(data, Year = Year - 2017) if (name==&quot;YRBS&quot;) { data &lt;- data %&gt;% mutate(across(all_of(x), ~as.numeric(scale(.)))) ml1 &lt;- brm( str_glue(&quot;{y} ~ Sex * Year * {x} + (Sex * Year * {x} | item)&quot;), family = bernoulli(&quot;probit_approx&quot;), control = list(adapt_delta = .98), prior = prior(student_t(9, 0, 1), class = &quot;sd&quot;) + prior(normal(0, 1), class = &quot;b&quot;), inits = &quot;0&quot;, data = data, chains = chains, iter = iter, cores = cores, file = str_glue(&quot;models/brm-{name}-{x}-{y}-ml1-probit&quot;) ) } else if (name==&quot;MTF&quot;) { data &lt;- data %&gt;% mutate(across(c(all_of(x), all_of(y)), ~as.numeric(scale(.)))) ml1 &lt;- brm( str_glue(&quot;{y} ~ Sex * Year * {x}&quot;), control = list(adapt_delta = .9), data = data, chains = chains, iter = iter, cores = cores, file = str_glue(&quot;models/brm-{name}-{x}-{y}-ml1&quot;) ) } else if (name==&quot;US&quot;) { data &lt;- data %&gt;% mutate(across(c(all_of(x), all_of(y)), ~as.numeric(scale(.)))) ml1 &lt;- brm( str_glue(&quot;{y} ~ Sex * Year * {x} + (1 | pidp)&quot;), control = list(adapt_delta = .9), data = data, chains = chains, iter = iter, cores = cores, file = str_glue(&quot;models/brm-{name}-{x}-{y}-ml1&quot;) ) } tibble( data = name, Technology = x, Outcome = y, ml1 = list(ml1) ) } x1 &lt;- fit(yrbs, &quot;YRBS&quot;, &quot;TV&quot;, &quot;Suicide&quot;) x2 &lt;- fit(yrbs, &quot;YRBS&quot;, &quot;DV&quot;, &quot;Suicide&quot;) x3 &lt;- fit(mtf, &quot;MTF&quot;, &quot;TV&quot;, &quot;Depression&quot;) x4 &lt;- fit(mtf, &quot;MTF&quot;, &quot;SM&quot;, &quot;Depression&quot;) x5 &lt;- fit(us, &quot;US&quot;, &quot;SM&quot;, &quot;Emotion&quot;) x6 &lt;- fit(us, &quot;US&quot;, &quot;SM&quot;, &quot;Conduct&quot;) x7 &lt;- fit(us, &quot;US&quot;, &quot;TV&quot;, &quot;Emotion&quot;) x8 &lt;- fit(us, &quot;US&quot;, &quot;TV&quot;, &quot;Conduct&quot;) # Rename variables fits &lt;- bind_rows(x1,x2,x3,x4,x5,x6,x7,x8) fits &lt;- fits %&gt;% mutate( Technology = ifelse( Technology %in% c(&quot;SM&quot;, &quot;DV&quot;), &quot;Social media / device&quot;, &quot;Television&quot; ) ) 7.2.2 Year and tech probs &lt;- c(.025, .1, .9, .975) pars &lt;- fits %&gt;% mutate( p = map( ml1, ~posterior_summary(., pars = &quot;^b_&quot;, probs = probs) %&gt;% as.data.frame() %&gt;% rownames_to_column(&quot;Parameter&quot;) %&gt;% tibble() ) ) %&gt;% unnest(p) %&gt;% select(-ml1) b_Year &lt;- pars %&gt;% filter(Parameter == &quot;b_Year&quot;) %&gt;% mutate(Parameter = &quot;Year&quot;) b_Tech &lt;- pars %&gt;% filter(Parameter %in% c(&quot;b_TV&quot;, &quot;b_DV&quot;, &quot;b_SM&quot;)) %&gt;% mutate(Parameter = &quot;Technology&quot;) b_Interaction &lt;- pars %&gt;% filter(Parameter %in% c(&quot;b_Year:TV&quot;, &quot;b_Year:DV&quot;, &quot;b_Year:SM&quot;)) %&gt;% mutate(Parameter = &quot;Year x Technology&quot;) p1 &lt;- bind_rows(b_Year, b_Tech, b_Interaction) %&gt;% mutate(Outcome = fct_rev(Outcome)) %&gt;% # Fill points based on if 95%CI includes zero mutate( Zero = ifelse( sign(Q2.5) == sign(Estimate) &amp; sign(Estimate) == sign(Q97.5), &quot;*&quot;, &quot;&quot; ) ) %&gt;% mutate( Parameter = factor(Parameter, levels = c(&quot;Year&quot;, &quot;Technology&quot;, &quot;Year x Technology&quot;)) ) %&gt;% ggplot(aes(Estimate, Outcome, shape = Technology, fill = Zero)) + scale_shape_manual(values = c(21, 22)) + scale_fill_manual(values = c(&quot;white&quot;, &quot;black&quot;), guide = FALSE) + scale_x_continuous( &quot;Parameter estimate&quot;, breaks = scales::pretty_breaks(), expand = expansion(.15) ) + geom_vline(xintercept = 0, lty = 2, size = .25) + geom_linerangeh( aes(xmin = Q2.5, xmax = Q97.5), size = .25, position = position_dodge2v(.5), show.legend = FALSE ) + geom_linerangeh( aes(xmin = Q10, xmax = Q90), size = .75, position = position_dodge2v(.5), show.legend = FALSE ) + geom_point( size = 2, position = position_dodge2v(.5), ) + facet_wrap(&quot;Parameter&quot;, scales = &quot;free_x&quot;, nrow = 1) + theme( legend.position = &quot;right&quot;, axis.title.y = element_blank(), panel.spacing.x = unit(12, &quot;pt&quot;) ) ((p1 %+% filter(p1$data, Parameter %in% c(&quot;Year&quot;, &quot;Technology&quot;)) + theme(axis.title.x = element_blank())) / p1 %+% filter(p1$data, Parameter == &quot;Year x Technology&quot;)) + plot_layout(guides = &quot;collect&quot;) &amp; theme(legend.position = &quot;right&quot;) ggsave(&quot;Figure2.png&quot;, width = 6, height = 4) # Get YRBS item-specific effects tmp1 &lt;- slice(fits, 1:2) %&gt;% mutate( o = map(ml1, ~rownames_to_column(as.data.frame(coef(.)$item[,,7]))) ) %&gt;% unnest(o) tmp &lt;- fits %&gt;% mutate( p = map( ml1, ~posterior_summary(., pars = &quot;b_Year:[TV|SM|DV]&quot;) %&gt;% as.data.frame() %&gt;% rownames_to_column() %&gt;% tibble() ) ) %&gt;% unnest(p) tmp %&gt;% ggplot(aes(Estimate, Outcome, col = Outcome)) + scale_color_brewer(palette = &quot;Set1&quot;) + scale_x_continuous( &quot;Linear interaction estimate (±95%CI)&quot;, breaks = scales::pretty_breaks(), expand = expansion(.2) ) + geom_vline(xintercept = 0, size = .25, lty = 2) + ggstance::geom_pointrangeh( shape = 21, fill = &quot;white&quot;, fatten = 3, aes(xmin=Q2.5, xmax=Q97.5) ) + # ggstance::geom_pointrangeh( # data = tmp1, aes(xmin = Q2.5, xmax = Q97.5), # size = .25, fatten = 1, # position = ggstance::position_dodge2v(.25) # ) + facet_wrap(&quot;Technology&quot;) + theme( axis.title.y = element_blank(), legend.position = &quot;none&quot;, legend.text = element_text(size = 8) ) # Sex pars %&gt;% filter(str_detect(Parameter, &quot;Sex1:Year:&quot;)) %&gt;% mutate(Parameter = &quot;Sex x Year x Tech&quot;) %&gt;% ggplot(aes(Estimate, Outcome, shape = Technology)) + scale_color_brewer(palette = &quot;Set1&quot;) + scale_x_continuous( &quot;Estimated parameter&quot;, breaks = scales::pretty_breaks(), expand = expansion(.25) ) + geom_vline(xintercept = 0, lty = 2, size = .25) + geom_linerangeh( aes(xmin = Q2.5, xmax = Q97.5), size = .25, position = position_dodge2v(.4), show.legend = FALSE ) + geom_linerangeh( aes(xmin = Q10, xmax = Q90), size = .75, position = position_dodge2v(.4), show.legend = FALSE ) + geom_point( size = 2, position = position_dodge2v(.4) ) + facet_wrap(&quot;Parameter&quot;, scales = &quot;free_x&quot;, nrow = 1) + theme( legend.position = &quot;bottom&quot;, axis.title.y = element_blank(), panel.spacing.x = unit(12, &quot;pt&quot;) ) "],
["latent-variable-models.html", "Chapter 8 Latent Variable Models 8.1 Data 8.2 Models 8.3 Results", " Chapter 8 Latent Variable Models # Parallel processing settings plan(multisession(workers = parallel::detectCores(logical = FALSE))) 8.1 Data mtf &lt;- read_rds(&quot;data/mtf.rds&quot;) us &lt;- read_rds(&quot;data/us.rds&quot;) yrbs &lt;- read_rds(&quot;data/yrbs.rds&quot;) 8.2 Models fit &lt;- function(data, items, x, y, name, missing = &quot;ml&quot;) { # Center year data &lt;- mutate(data, Year = Year - 2017) # Contrast code sex data &lt;- mutate(data, Sex = ifelse(Sex==&quot;Male&quot;, -0.5, 0.5)) # Drop rows with missing predictor data &lt;- drop_na(data, all_of(x)) # Drop rows where all outcome items are missing data &lt;- drop_na(data, all_of(y)) # Mean-center predictors data &lt;- data %&gt;% mutate( across( all_of(x), ~as.numeric(scale(., center = TRUE, scale = FALSE)) ) ) # Ordered? if (name==&quot;YRBS&quot;) { data &lt;- mutate(data, across(sad_lonely:suicide_3, ordered)) missing = &quot;listwise&quot; } # Create interaction terms because lavaan doesn&#39;t know how to newdata &lt;- model.matrix( as.formula(str_glue(&quot;{y} ~ Sex * Year * {x}&quot;)), data = data )[,-1] %&gt;% # Take out the intercept column because it causes lavaan to break as.data.frame() # Interaction term breaks lavaan so change to dot names(newdata) &lt;- str_replace_all(names(newdata), &quot;:&quot;, &quot;.&quot;) # return(newdata) newdata &lt;- cbind(data[,items], newdata) # Combine names of items to a string for lavaan model items_all &lt;- paste0(items, collapse = &quot; + &quot;) # Model strings sem0 &lt;- str_glue(&quot;{y} =~ {items_all}\\n{y} ~ Sex + Year + Sex.Year&quot;) sem1 &lt;- str_glue(&quot;{y} =~ {items_all}\\n{y} ~ Sex + Year + {x} + Sex.Year + Sex.{x} + Year.{x} + Sex.Year.{x}&quot;) ml0 &lt;- sem(sem0, data = newdata, missing = missing) ml1 &lt;- sem(sem1, data = newdata, missing = missing) tibble( data = name, Technology = x, Outcome = y, ml0 = list(ml0), ml1 = list(ml1) ) } x1 %&lt;-% fit(yrbs, c(&quot;sad_lonely&quot;, paste0(&quot;suicide_&quot;, 1:3)), &quot;TV&quot;, &quot;Suicide&quot;, &quot;YRBS&quot;) x2 %&lt;-% fit(yrbs, c(&quot;sad_lonely&quot;, paste0(&quot;suicide_&quot;, 1:3)), &quot;DV&quot;, &quot;Suicide&quot;, &quot;YRBS&quot;) x3 %&lt;-% fit(mtf, paste0(&quot;D_B_&quot;, 1:6), &quot;TV&quot;, &quot;Depression&quot;, &quot;MTF&quot;) x4 %&lt;-% fit(mtf, paste0(&quot;D_B_&quot;, 1:6), &quot;SM&quot;, &quot;Depression&quot;, &quot;MTF&quot;) sdq_con &lt;- c(&quot;sdqe&quot;, &quot;sdqg&quot;, &quot;sdql&quot;, &quot;sdqr&quot;, &quot;sdqv&quot;) sdq_emo &lt;- c(&quot;sdqc&quot;, &quot;sdqh&quot;, &quot;sdqm&quot;, &quot;sdqp&quot;, &quot;sdqx&quot;) x5 %&lt;-% fit(us, sdq_con, &quot;TV&quot;, &quot;Conduct&quot;, &quot;US&quot;) x6 %&lt;-% fit(us, sdq_con, &quot;SM&quot;, &quot;Conduct&quot;, &quot;US&quot;) x7 %&lt;-% fit(us, sdq_emo, &quot;TV&quot;, &quot;Emotion&quot;, &quot;US&quot;) x8 %&lt;-% fit(us, sdq_emo, &quot;SM&quot;, &quot;Emotion&quot;, &quot;US&quot;) # Rename variables fits &lt;- bind_rows(x1,x2,x3,x4,x5,x6,x7,x8) fits &lt;- fits %&gt;% mutate( Technology = ifelse( Technology %in% c(&quot;SM&quot;, &quot;DV&quot;), &quot;Social media / device&quot;, &quot;Television&quot; ) ) %&gt;% arrange(Outcome, Technology) 8.3 Results coefs &lt;- fits %&gt;% mutate(p = map(ml1, ~tidy(., conf.int = TRUE))) %&gt;% unnest(p) %&gt;% filter(op == &quot;~&quot;) %&gt;% separate(term, c(&quot;lhs&quot;, &quot;rhs&quot;), sep = &quot; ~ &quot;) %&gt;% mutate(N = map_dbl(ml1, nobs)) %&gt;% mutate(N = scales::comma(N, accuracy = 1)) coefs %&gt;% mutate(Parameter = str_replace(rhs, &quot;SM|DV|TV&quot;, &quot;Technology&quot;)) %&gt;% mutate(Parameter = str_replace_all(Parameter, &quot;\\\\.&quot;, &quot;:&quot;)) %&gt;% mutate(Parameter = fct_inorder(Parameter)) %&gt;% mutate(Outcome = fct_rev(Outcome)) %&gt;% ggplot(aes(estimate, Outcome, shape = Technology, fill = p.value &lt; 0.05)) + scale_shape_manual(values = c(21, 22)) + scale_fill_manual(values = c(&quot;white&quot;, &quot;black&quot;), guide = FALSE) + scale_x_continuous( &quot;Parameter estimate&quot;, breaks = scales::pretty_breaks(), expand = expansion(.25) ) + geom_vline(xintercept = 0, lty = 2, size = .25) + geom_linerangeh( aes(xmin = conf.low, xmax = conf.high), size = .25, position = position_dodge2v(.4), show.legend = FALSE ) + geom_point( size = 2, position = position_dodge2v(.4), ) + # geom_text( # aes(label = N), size = 2, vjust = 2, # position = position_dodge2v(.4) # ) + facet_wrap(&quot;Parameter&quot;, scales = &quot;free_x&quot;, nrow = 2) + theme( legend.position = c(.875, .25), axis.title.y = element_blank(), panel.spacing.x = unit(12, &quot;pt&quot;) ) # Numbers coefs %&gt;% filter(Outcome == &quot;Suicide&quot;, rhs == &quot;TV&quot;) %&gt;% select(data:Outcome, estimate:conf.high) coefs %&gt;% distinct(data, Technology, Outcome, N) ## # A tibble: 8 x 4 ## data Technology Outcome N ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; ## 1 US Social media / device Conduct 18,815 ## 2 US Television Conduct 19,079 ## 3 MTF Social media / device Depression 78,357 ## 4 MTF Television Depression 367,444 ## 5 US Social media / device Emotion 18,811 ## 6 US Television Emotion 19,074 ## 7 YRBS Social media / device Suicide 24,584 ## 8 YRBS Television Suicide 24,593 Just time fits %&gt;% mutate(p = map(ml0, ~tidy(., conf.int = TRUE))) %&gt;% unnest(p) %&gt;% filter(op == &quot;~&quot;) %&gt;% separate(term, c(&quot;lhs&quot;, &quot;rhs&quot;), sep = &quot; ~ &quot;) %&gt;% # mutate( # Parameter = factor(rhs, levels = c(&quot;Year&quot;, &quot;Technology&quot;, &quot;Year x Technology&quot;)) # ) %&gt;% mutate(Outcome = fct_rev(Outcome)) %&gt;% ggplot(aes(estimate, Outcome, shape = Technology, fill = p.value &lt; 0.05)) + scale_shape_manual(values = c(21, 22)) + scale_fill_manual(values = c(&quot;white&quot;, &quot;black&quot;), guide = FALSE) + scale_x_continuous( &quot;Parameter estimate&quot;, breaks = scales::pretty_breaks(), expand = expansion(.25) ) + geom_vline(xintercept = 0, lty = 2, size = .25) + geom_linerangeh( aes(xmin = conf.low, xmax = conf.high), size = .25, position = position_dodge2v(.4), show.legend = FALSE ) + geom_point( size = 2, position = position_dodge2v(.4), ) + facet_wrap(&quot;rhs&quot;, scales = &quot;free_x&quot;, nrow = 1) + theme( legend.position = &quot;bottom&quot;, axis.title.y = element_blank(), panel.spacing.x = unit(12, &quot;pt&quot;) ) "]
]
