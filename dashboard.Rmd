---
title: "Results"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  cache = TRUE,
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  fig.width = 8,
  fig.height = 6,
  fig.retina = 2
)
theme_set(
  theme_linedraw() +
    theme(
      panel.grid.minor = element_blank()
    )
)
set.seed(1)
loadd(mtf_aggregated, us_aggregated, yrbs)
```

# Monitoring the Future

## Column

We look at the relationship between well-being (depression, loneliness, and self esteem) and technology use (social media and tv) longitudinally in the Monitoring the Future dataset. **Note that all variables are recoded such that greater values indicate greater well-being** (e.g. greater values of loneliness indicate greater well-being re loneliness).

### Temporal trends

```{r}
plot_data(
  mtf_aggregated, 
  variables = c(social_media, tv, self_esteem:loneliness)
  )
```

## Column {.tabset}

### Social media

#### Model 1

This model predicts standardized depression, loneliness, and self-esteem in separate models from standardized social media use separately for each year, sex, and grade. That is, we fit 

$$
y_i \sim N(\alpha + \beta \text{social media}_i, \sigma^2)
$$ 

(`lm(y ~ social_media)`) separately to to each combination of year, sex, grade, and outcome (y). We then plot the $\beta$ coefficients below.

```{r}
fits_1 <- make_fits_1(
  mtf_aggregated, 
  yvars = c(self_esteem:loneliness),
  xvars = c(social_media, tv)
)
plot_fits_1(fits_1, "social_media")
```

- Social media looks consistently associated with worse outcomes for younger individuals and females. 
- Overall, outcomes appear to be improving over time.

#### Model 2

This model predicts standardized well-being outcomes from standardized social media use, year and their interaction, separately for every combination of sex, age, and outcome. This time we assume that year is a linear predictor to get estimates of temporal trends in the social media - well-being relationship. That is, we fit 

$$
y_i \sim N(\alpha + \beta_1 \text{social media}_i + \beta_2 \text{year}_i + \beta_3 \text{social media}_i\times\text{year}_i, \sigma^2)
$$ 

(`lm(y ~ social_media * year)`) separately to each of the three outcomes and combinations of sex and grade.

```{r}
fits_2 <- make_fits_2(
  mtf_aggregated, 
  yvars = c(self_esteem:loneliness),
  xvars = c(social_media, tv)
)
plot_fits_2(fits_2, "social_media")
```

For all subgroups (sex and grades), the social-media - well-being relationship is becoming more positive over time. In 2017, social media use related positively to self esteem, and negatively to loneliness. The estimated social media by year interaction parameters (the magnitude of change in the social media - well being relation per decade) are shown below.

```{r}
tabulate_fits_2(fits_2, "social_media")
```

### TV

#### Model 1

This is the same model as Model 1 for social media use, but now we use TV use as the predictor.

```{r}
plot_fits_1(fits_1, "tv")
```

#### Model 2

This is the same model as Model 2 for social media use, but now we use TV use as the predictor.

```{r}
plot_fits_2(fits_2, "tv")
```

- The TV - well-being relationship is becoming more positive over time. 

The estimated TV by year interaction parameters (the magnitude of change in the TV - well being relation per decade) are shown below.

```{r}
tabulate_fits_2(fits_2, "tv")
```


# Youth Risk Behavior Survey

## Column

We look at the relationship between well-being (four suicide questions and one question on sadness and hopelessness) and technology use (tv use and devce) with the YRBS dataset. **Note that all variables are recoded such that greater values indicate greater well-being** (e.g. greater values of suicide indicate greater well-being re suicidal thought).

### Temporal trends

```{r yrbs-data-figure}
# Plot all measures' averages across time
plot_data(yrbs, c(sad_hopeless:device))
```

## Column {.tabset}

### TV

#### Model 1

The YRBS well-being variables are a mix of binary and ordinal responses, we therefore use an ordinal regression model with a probit link, which results in beta coefficients interpretable exactly as in the MtF models. Otherwise models 1 and 2 are the same as the MtF models.

```{r}
fits_1 <- make_fits_1(
  yrbs %>% mutate(age = grade), 
  yvars = c(sad_hopeless:suicide_4),
  xvars = c(tv, device),
  model = ~ordinal::clm(factor(y) ~ x, link = "probit", data = .)
)
plot_fits_1(fits_1, "tv")
```

- The majority of relationships between TV viewing and well-being are negative, but very small and non-significant
- I can't see anything happening over time

#### Model 2

Model two includes year as a linear predictor, and an interaction with year and tv use (see Model 2 for MtF dataset).

```{r}
fits_2 <- make_fits_2(
  yrbs %>% mutate(age = grade), 
  yvars = c(sad_hopeless:suicide_4),
  xvars = c(tv, device),
  model = ~ordinal::clm(factor(y) ~ x*year, link = "probit", data = .)
)
plot_fits_2(fits_2, "tv")
```

- Suicide 3 and 4 specifically ask about how many times the respondent attempted suicide, and if they did, whether it resulted in hospitalization, respectively. Those two variables are the only ones that are consistently negatively predicted by tv viewing.
- There is no consistent pattern of change over time, as shown by the interaction terms below

```{r}
tabulate_fits_2(fits_2, "tv")
```

### Digital device use

#### Model 1

```{r}
plot_fits_1(fits_1, "device")
```

- Digital device use is a stronger negative predictor of well-being than TV viewing.
- The relationship appears similar across years and ages

#### Model 2

```{r}
plot_fits_2(fits_2, "device")
```

- No consistent pattern of change over time
- Interaction terms are tabulated below

```{r}
tabulate_fits_2(fits_2, "device")
```

# Understanding Society

```{r}
us_aggregated <- us_aggregated %>% 
  drop_na(sex, year, age) %>% 
  mutate(age = factor(age)) %>% 
  mutate(year = as.numeric(year))
```

## Column

We look at the relationship between well-being (scghq, scsf, sdq, and self esteem) and technology use (social media and tv). **Note that all variables are recoded such that greater values indicate greater well-being**.

Unlike the MtF and YRBS datasets, Understanding Society has surveyed many individuals repeatedly across time, and we can therefore look at within-person relationships as well.

### Temporal trends

```{r}
# Plot all measures' averages across time
plot_data(us_aggregated, c(socialmedia, tvamount, sdq, selfesteem, scghq, scsf))
```

## Column {.tabset}

### TV

#### Model 1

```{r}
fits_1 <- make_fits_1(
  us_aggregated,
  yvars = c(sdq, selfesteem, scghq, scsf),
  xvars = c(socialmedia, tvamount)
)
plot_fits_1(fits_1, "tvamount")
```

#### Model 2

```{r}
fits_2 <- make_fits_2(
  us_aggregated,
  yvars = c(sdq, selfesteem, scghq, scsf),
  xvars = c(socialmedia, tvamount)
)
plot_fits_2(fits_2, "tvamount")
```

```{r}
tabulate_fits_2(fits_2, "tvamount")
```

### Digital device use

#### Model 1

```{r}
plot_fits_1(fits_1, "socialmedia")
```

#### Model 2

```{r}
plot_fits_2(fits_2, "socialmedia")
```

```{r}
tabulate_fits_2(fits_2, "socialmedia")
```

### Within-person relationships

```{r, eval = FALSE}
# Fit lme4 model to outcome ~ predictor [todo]
lme4_fit_model <- function(data, y, x) {
  lmer(
    as.formula(glue("{y} ~ {x}*sex*grade*year + (1 + {x} | year)")),
    data = data %>% mutate(year = year - min(unique(data$year)))
  )
}
```

