---
title: "Results"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  cache = FALSE,
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  fig.width = 8,
  fig.height = 6,
  fig.retina = 2
)
theme_set(
  theme_linedraw() +
    theme(
      panel.grid.minor = element_blank(),
      strip.background = element_rect(fill = "#2780e3", colour = "#2780e3")
    )
)
```


# Summary

## Column

### Summary

#### Introduction

We studied the relationship between digital technology use and well-being using three representative large datasets, Monitoring the Future (MTF), Youth Risk Behavior Surveillance System (YRBSS), and Understanding Society (US). Each dataset contained two digital technology use variables (Television viewing was measured in all surveys, MTF and US included a social media use question, and YRBSS a digital device use question), and a number of well-being items and scales. **We recoded all well-being items such that greater values indicate greater well-being (e.g. greater depression values indicate lower depression).**

#### Methods and results

First, for each of the datasets, we fitted an ordinary linear regression model, separately for each of the standardized well-being outcomes ($y$) and standardized technology use variables ($x$), which predicted the outcome from the technology use variable, and its interaction with year (`lm(y ~ x * year)`). The key coefficients were the simple effects of each $x$ on each outcome $y$, and the interaction terms $x \times year$ (linear change of effects over time).

By and large, the simple relations were small and negative (the large points and 95%CI error bars in the figure on the right). Generally, the "effects" of social media and digital device use were more negative than those of TV viewing. There was also great variation in the effects across ages and sexes (small points).

The results on the technology effects' change over time were more mixed. In the MTF dataset, the change was clearly positive; technology effects on wellbeing were becoming more positive over time. However, there was no clear pattern in the US and YRBSS datasets, and both negative and positive significant interactions were observed.

The results for each dataset are presented in more detail in their own tabs in the dashboard ([MTF](#monitoring-the-future), [YRBS](#youth-risk-behavior-survey), and [US](#understanding-society)).

#### What's next

- If the interaction model is interesting, do SCA
- Longitudinal / within-person analysis of Understanding Society dataset
- Hierarchical model to better summarize models across years, sexes, and ages

## Column {.tabset}

### Technology effects

```{r}
loadd(fits1, fits2)
# Get coefficients from fits
coefs <- bind_rows(fits1, fits2) %>% 
  ungroup() %>% 
  mutate(outcome = str_remove(outcome, "y_"), predictor = str_remove(predictor, "x_")) %>% 
  mutate(out = map(fit, ~tidy(., conf.int = TRUE, conf.type = "Wald"))) %>% 
  mutate(N = map_dbl(fit, ~nrow(.$model))) %>% 
  unnest(out)
```

```{r}
xs <- filter(coefs, term == "x")
# Plot effect of X on Y at year 2010
p <- drop_na(xs, sex) %>% 
  ggplot(aes(estimate, outcome, col = predictor)) +
  geom_vline(xintercept = 0) +
  geom_point(
    alpha = .5,
    shape = 1, position = position_jitterdodgev(jitter.height = .1, dodge.height = .6),
    aes(text = glue("b = {round(estimate, 2)}, p = {round(p.value, 2)} ({sex} {age})"), group = predictor)
  ) +
  geom_point(
    data = filter(xs, is.na(sex)),
    aes(
      text = glue("b = {round(estimate, 2)}, p = {round(p.value, 2)} (Average)"), 
      group = predictor
    ), 
    position = position_dodgev(.6), size = 2
  ) +
  geom_errorbarh(
    data = filter(xs, is.na(sex)),
    aes(xmin = conf.low, xmax = conf.high), 
    position = position_dodgev(.6), height = .15
  ) +
  facet_wrap(~study, ncol = 1, scales = "free_y") +
  labs(
    title = "Technology effects in 2010"
  ) +
  theme(axis.title = element_blank())
fig <- ggplotly(p, tooltip = c("text")) 
fig <- fig %>% 
  layout(
    xaxis = list(
      title = "Standardized regression coefficient",
      zeroline = TRUE,
      showline = TRUE,
      showgrid = FALSE
    )
  )
fig
```

### Effects' change over time

```{r}
xs <- filter(coefs, term == "x:year")
# Plot interaction terms
p <- drop_na(xs, sex) %>% 
  ggplot(aes(estimate, outcome, col = predictor)) +
  geom_vline(xintercept = 0) +
  geom_point(
    alpha = .5,
    shape = 1, position = position_jitterdodgev(jitter.height = .1, dodge.height = .6),
    aes(text = glue("b = {round(estimate, 2)}, p = {round(p.value, 2)} ({sex} {age})"), group = predictor)
  ) +
  geom_point(
    data = filter(xs, is.na(sex)),
    aes(
      text = glue("b = {round(estimate, 2)}, p = {round(p.value, 2)} (Average)"), 
      group = predictor
    ), 
    position = position_dodgev(.6), size = 2
  ) +
  geom_errorbarh(
    data = filter(xs, is.na(sex)),
    aes(xmin = conf.low, xmax = conf.high), 
    position = position_dodgev(.6), height = .15
  ) +
  facet_wrap(~study, ncol = 1, scales = "free_y") +
  labs(
    title = "Yearly changes in technology effects"
  ) +
  theme(axis.title = element_blank())
fig <- ggplotly(p, tooltip = c("text")) 
fig <- fig %>% 
  layout(
    xaxis = list(
      title = "Standardized regression coefficient",
      zeroline = TRUE,
      showline = TRUE,
      showgrid = FALSE
    )
  )
fig
```

# Monitoring the Future

## Column

### Temporal trends

```{r mtf-data-plot, fig.height = 8}
loadd(mtf)
fig <- plot_data(mtf, variables = c(contains("y_"), contains("x_")))
fig
```

## Column {.tabset}

### TV

```{r}
mtf_fits <- mtf %>% 
  mutate(year = year - 2010) %>% 
  group_by(year, sex, age) %>% 
  make_fits(xvars = starts_with("x_"), yvars = starts_with("y_"), model = ~lm(y ~ x, data = .)) %>% 
  ungroup() %>% 
  mutate(outcome = str_remove(outcome, "y_"), predictor = str_remove(predictor, "x_")) %>% 
  mutate(year = year + 2010)
mtf_fits %>% 
  plot_fits("tv")
```

### Social media

```{r}
mtf_fits %>% 
  plot_fits("social_media")
```

# Youth Risk Behavior Survey

## Column

### Temporal trends

```{r yrbs-data-figure, fig.height = 8}
loadd(yrbs)
fig <- plot_data(yrbs, variables = c(contains("y_"), contains("x_")))
fig
```

## Column {.tabset}

### TV

```{r}
yrbs_fits <- yrbs %>% 
  mutate(year = year - 2010) %>% 
  group_by(year, sex, age) %>% 
  make_fits(xvars = starts_with("x_"), yvars = starts_with("y_"), model = ~lm(y ~ x, data = .)) %>% 
  ungroup() %>% 
  mutate(outcome = str_remove(outcome, "y_"), predictor = str_remove(predictor, "x_")) %>% 
  mutate(year = year + 2010)
yrbs_fits %>% 
  plot_fits("tv")
```

### Digital device use

```{r}
yrbs_fits %>%  
  plot_fits("device")
```

# Understanding Society

## Column

### Temporal trends

```{r us-data-plot, fig.height = 8}
loadd(us)
us <- select(us, -y_sca)  # Not enough observations over time
fig <- plot_data(us, variables = c(contains("y_"), contains("x_")))
fig
```

## Column {.tabset}

### TV

```{r}
us_fits <- us %>% 
  mutate(year = year - 2010) %>% 
  group_by(year, sex, age) %>% 
  make_fits(xvars = starts_with("x_"), yvars = starts_with("y_"), model = ~lm(y ~ x, data = .)) %>% 
  ungroup() %>% 
  mutate(outcome = str_remove(outcome, "y_"), predictor = str_remove(predictor, "x_")) %>% 
  mutate(year = year + 2010)
us_fits %>% 
  plot_fits("tv")
```

### Social media

```{r}
us_fits %>% 
  plot_fits("social_media")
```

### Within-person relationships

Unlike the MtF and YRBS datasets, Understanding Society has surveyed many individuals repeatedly across time, and we can therefore look at within-person relationships as well.

Nothing here yet
